{{ block chart() }}
  <div
    _="set :settings to settingsChart({{ .ColumnCount }}, {{ .RowCount }}, {{ .Spacing }}, {{ .Padding }})
	   set :settingsNames to settingsNames()
	   set :settingsFuncs to settingsFuncs()
	   init
	 	  updateChart(:settingsNames, :settings)
		  show me
	   end
	   on chartUpdate(setting, value)
	 	  set f to :settingsFuncs[setting]
	 	  set :settings[setting].val to f(value)
	 	  set :settings[setting].rawVal to value
	 	  updateChart(:settingsNames, :settings)"
    id="chart"
    class="shadow-lg grid place-items-center gap-4"
    style="background-color: {{ .BgColor }}; display: none;"
  >
    <h1
      _="on update(val) get the markdown(val) then set my.innerHTML to it"
      id="chart-title"
      class="font-condensed"
      style="color: {{ .TextColor }};"
    >
      {{ .Title }}
    </h1>
    <ul id="images" class="grid sortable">
      {{ textPlacement := .ImagesTextPlacement }}
      {{ imagesHeight := .ImagesHeight }}
      {{ textColor := .TextColor }}
      {{ imagesShape := .ImagesShape == "portrait" ? "aspect-[4/5]" : "aspect-square" }}
      {{ imagesRoundedCorners := .ImagesRoundedCorners ? "rounded" : "" }}

      {{ range i := .Images }}
        <li>
          <figure
            _="on click
			       toggle between .hidden and .block on <footer/>
			       toggle between .hidden and .grid on #search-mobile
				   set $imgIndex to {{ i }}
			       set searchMobile to #search-mobile-input then searchMobile.focus()"
            class="outline-cyan-600 hover:outline hover:outline-4 relative"
          >
            {{ if textPlacement == "overlay" }}
              <figcaption
                class="z-10 absolute inset-0 text-left text-sm leading-tight bg-gradient-to-t from-slate-800/80 grid"
                style="color: {{ textColor }};"
              >
                <div class="justify-self-start self-end p-2">
                  <strong>{{ .Title }}</strong>
                  <br />
                  {{ .Caption }}
                </div>
              </figcaption>
            {{ end }}
            <img
              _="on dragover
					 if not $draggingFromResults
					     exit
					 end
				     halt the event
					 set the target's style.outline to '1px solid red'
				 on dragleave or drop
					 set the target's style.outline to ''
				 on drop
					 if not $draggingFromResults
					     exit
					 end
				     get the event.dataTransfer.getData('text/plain')
				     then put it into me.src"
              id="chart-img-{{ i }}"
              class="{{ imagesShape }} {{ imagesRoundedCorners }} object-center object-cover \
					 transition-all duration-75 shadow-md"
              role="img"
              src="{{ .URL }}"
              style="height: {{ imagesHeight }}px;"
            />
            {{ if textPlacement == "inline" }}
              <figcaption
                class="text-center text-sm mt-2 leading-snug"
                style="color: {{ textColor }};"
              >
                <strong>{{ .Title }}</strong>
                <br />
                {{ .Caption }}
              </figcaption>
            {{ end }}
          </figure>
        </li>
      {{ end }}
    </ul>
  </div>
{{ end }}
