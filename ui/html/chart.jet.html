{{ block chart() }}
	<div
		_="set :settings to settingsChart({{ .ColumnCount }}, {{ .RowCount }}, {{ .Spacing }}, {{ .Padding }})
		   set :settingsNames to settingsNames()
		   set :settingsFuncs to settingsFuncs()
		   init
			   updateChart(:settingsNames, :settings)
			   show me
		   end
		   -- mobile replace on search
		   on chartImages(src, title, caption)
		       set imgs to the children of #images
			   set imgTxt to the children of #text
			   send replace(src: src, title: title, caption: caption) to imgs[$imgIndex]
		   end
		   on chartUpdate(setting, value)
			   set f to :settingsFuncs[setting]
			   set :settings[setting].val to f(value)
			   set :settings[setting].rawVal to value
			   updateChart(:settingsNames, :settings)
		   end
		   on chartTextPlacement(value)
			   if value is 'hide' or value is 'inline' or value is 'overlay'
			       set <chart-image/>'s @text-placement to value
				   add [@text-placement=hide] to #images-text
			   end
			   if value is 'left' or value is 'below' or value is 'right'
				   set #images-text's @text-placement to value
				   add [@text-placement=hide] to <chart-image/>
			   end
		   end
		   on chartImagesShape(value)
		       set <chart-image/>'s @shape to value
		   end
		   on chartImagesWidth(value)
		       set <chart-image/>'s @width to value
		   end"
		id="chart"
		class="shadow-lg grid place-items-center gap-4"
		style="background-color: {{ .BgColor }}; display: none;"
	>
		<h1
			_="on update(val) get the markdown(val) then set my.innerHTML to it"
			id="chart-title"
			class="font-condensed"
			style="color: {{ .TextColor }};"
		>
			{{ .Title }}
		</h1>
		<chart-images-text id="images-text" text-placement="hide">
			<ul
				_="init
					   send update(images: me) to #text
				   end
				   on drop(target)
					   send update(images: me) to #text

				   -- sortable events
				   on move(dragged)
					   send update(images: me) to #text
				       set the dragged's @data-was-dragging to true
				   on end(item)
					   set the item's @data-was-dragging to false"
				id="images"
				class="grid"
				slot="images"
			>
				{{ imagesHeight := .ImagesHeight }}
				{{ textColor := .TextColor }}
				{{ shape := .ImagesShape }}
				{{ imagesRoundedCorners := .ImagesRoundedCorners ? "rounded" : "" }}

				{{ range i := .Images }}
					<chart-image
						_="on touchend
							   if @data-was-dragging
								   remove @data-was-dragging from me
								   exit
							   end
							   wait 150ms
							   toggle between .hidden and .block on <footer/>
							   toggle between .hidden and .grid on #search-mobile
							   set $imgIndex to {{ i }}
							   set searchMobile to #search-mobile-input then searchMobile.focus()
							end"
						class="aria-hidden:hidden sortable-item"
						index="{{ i }}"
						title="{{ .Title }}"
						caption="{{ .Caption }}"
						src="{{ .URL }}"
						width="{{ imagesHeight }}"
						text-color="{{ textColor }}"
						text-placement="hide"
						shape="{{ shape }}"
						aria-hidden="false"
					>
					</chart-image>
				{{ end }}
			</ul>
			<chart-text id="text" slot="text" columns="{{ .ColumnCount }}" rows="{{ .RowCount }}"></chart-text>
		</chart-images-text>
	</div>
{{ end }}
